<!DOCTYPE html><!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en-US"> <![endif]--><!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en-US"> <![endif]--><!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en-US"> <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en-US"><!--<![endif]--><head>
<title>Email Protection | Cloudflare</title>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="robots" content="noindex, nofollow">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" id="cf_styles-css" href="https://legend-motors-cars.github.io/legendmotorscars/cdn-cgi/styles/cf.errors.css">
<!--[if lt IE 9]><link rel="stylesheet" id='cf_styles-ie-css' href="/cdn-cgi/styles/cf.errors.ie.css" /><![endif]-->
<style>body{margin:0;padding:0}</style>


<!--[if gte IE 10]><!-->
<script>
  if (!navigator.cookieEnabled) {
    window.addEventListener('DOMContentLoaded', function () {
      var cookieEl = document.getElementById('cookie-alert');
      cookieEl.style.display = 'block';
    })
  }
</script>
<!--<![endif]-->


<style type="text/css">
        .wpcf7-form.sent p {
            display: block !important;
        }

        /* Стили для корректного отображения сообщения об успехе */
        .vehica-contact-form .wpcf7-mail-sent-ok {
            position: static !important; /* Возвращаем в поток документа */
            width: auto !important;      /* Автоматическая ширина */
            height: auto !important;     /* Автоматическая высота */
            padding: 15px !important;    /* Равномерный внутренний отступ */
            margin-top: 15px !important; /* Отступ сверху от кнопки */
            background: #419e72;         /* Зеленый фон */
            color: #fff;
            border-radius: 4px;
            text-align: center;
        }
    </style><!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M3578QRF');</script>
<!-- End Google Tag Manager -->
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M3578QRF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <div id="cf-wrapper">
    <div class="cf-alert cf-alert-error cf-cookie-error" id="cookie-alert" data-translate="enable_cookies">Please enable cookies.</div>
    <div id="cf-error-details" class="cf-error-details-wrapper">
      <div class="cf-wrapper cf-header cf-error-overview">
        <h1 data-translate="block_headline">Email Protection</h1>
        <h2 class="cf-subheadline"><span data-translate="unable_to_access">You are unable to access this email address</span> banidevizionare-ro.sa.com</h2>
      </div><!-- /.header -->

      <div class="cf-section cf-wrapper">
        <div class="cf-columns two">
          <div class="cf-column">
            <p>The website from which you got to this page is protected by Cloudflare. Email addresses on that page have been hidden in order to keep them from being accessed by malicious bots. <strong>You must enable Javascript in your browser in order to decode the e-mail address</strong>.</p>
            <p>If you have a website and are interested in protecting it in a similar way, you can <a rel="noopener noreferrer" href="https://www.cloudflare.com/sign-up?utm_source=email_protection">sign up for Cloudflare</a>.</p>
          </div>

          <div class="cf-column">
            <div class="grid_4">
              <div class="rail">
                  <div class="panel">
                      <ul class="nobullets">
                        <li><a rel="noopener noreferrer" class="modal-link-faq" href="https://developers.cloudflare.com/waf/tools/scrape-shield/email-address-obfuscation/">How does Cloudflare protect email addresses on website from spammers?</a></li>
                        <li><a rel="noopener noreferrer" class="modal-link-faq" href="https://developers.cloudflare.com/fundamentals/setup/account/create-account/">Can I sign up for Cloudflare?</a></li>
                    </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div><!-- /.section -->

      <div class="cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300">
  <p class="text-13">
    <span class="cf-footer-item sm:block sm:mb-1">Cloudflare Ray ID: <strong class="font-semibold">9808eff8ab08bcf6</strong></span>
    <span class="cf-footer-separator sm:hidden">•</span>
    <span id="cf-footer-item-ip" class="cf-footer-item hidden sm:block sm:mb-1">
      Your IP:
      <button type="button" id="cf-footer-ip-reveal" class="cf-footer-ip-reveal-btn">Click to reveal</button>
      <span class="hidden" id="cf-footer-ip">2607:f170:14:11::a80</span>
      <span class="cf-footer-separator sm:hidden">•</span>
    </span>
    <span class="cf-footer-item sm:block sm:mb-1"><span>Performance &amp; security by</span> <a rel="noopener noreferrer" href="https://www.cloudflare.com/5xx-error-landing" id="brand_link" target="_blank">Cloudflare</a></span>
    
  </p>
  <script>(function(){function d(){var b=a.getElementById("cf-footer-item-ip"),c=a.getElementById("cf-footer-ip-reveal");b&&"classList"in b&&(b.classList.remove("hidden"),c.addEventListener("click",function(){c.classList.add("hidden");a.getElementById("cf-footer-ip").classList.remove("hidden")}))}var a=document;document.addEventListener&&a.addEventListener("DOMContentLoaded",d)})();</script>
</div><!-- /.error-footer -->


    </div><!-- /#cf-error-details -->
  </div><!-- /#cf-wrapper -->

  <script>
  window._cf_translation = {};
  
  
</script>



<script>/**
 * form-handler.js (Final Version with GTM Custom Event Trigger)
 * 
 * This script handles form submissions by sending data to a Cloudflare Worker.
 * It includes client-side validation for email and a required checkbox.
 * Upon successful submission, it clears the form, displays a success message,
 * and pushes a custom event to the dataLayer for Google Tag Manager to track conversions.
 */
document.addEventListener('DOMContentLoaded', () => {
    // URL вашего Cloudflare Worker
    const WORKER_URL = 'https://test-form-sender.melniccristina58.workers.dev'; 

    document.querySelectorAll('form.wpcf7-form'  ).forEach(form => {
        form.addEventListener('submit', async (event) => {
            // Предотвращаем стандартную отправку формы
            event.preventDefault();
            
            // Убираем старые сообщения и сбрасываем стили полей
            removeOldMessages(form);
            resetFieldStyles(form);

            // --- ОРИГИНАЛЬНАЯ ВАЛИДАЦИЯ (без изменений) ---
            const emailField = form.querySelector('input[name="your-email"]');
            const privacyCheckbox = form.querySelector('input[name="vehica-accept"]');
            
            let isValid = true;
            let errorMessage = '';

            // 1. Проверка чекбокса
            if (!privacyCheckbox || !privacyCheckbox.checked) {
                isValid = false;
                errorMessage = 'You must accept the terms and conditions.';
                highlightField(privacyCheckbox); // Подсвечиваем поле
            }

            // 2. Проверка Email
            if (!emailField || !isValidEmail(emailField.value)) {
                isValid = false;
                errorMessage = 'Please provide a valid email address.';
                highlightField(emailField); // Подсвечиваем поле
            }
            // --------------------------------

            // Если форма невалидна, показываем ошибку и останавливаемся
            if (!isValid) {
                displayMessage(form, errorMessage, 'error');
                return; // Прерываем отправку
            }

            // Если все хорошо, продолжаем отправку...
            const submitButton = form.querySelector('.wpcf7-submit');
            const originalButtonText = submitButton ? submitButton.value : 'Send';
            
            if (submitButton) {
                submitButton.value = 'Sending...';
                submitButton.disabled = true;
            }

            try {
                const formData = new FormData(form);
                const originalAction = form.getAttribute('action');
                // Формируем полный URL для воркера, сохраняя путь из action формы
                const targetUrl = WORKER_URL + new URL(originalAction, window.location.href).pathname;

                const response = await fetch(targetUrl, {
                    method: 'POST',
                    body: formData,
                });

                const data = await response.json();

                // --- ДОПОЛНЕНО: УЛУЧШЕННАЯ ОБРАБОТКА ОТВЕТА ---
                // Проверяем, что ответ не только успешный (status 200), но и не является ошибкой от воркера
                if (response.ok && data.status === 'mail_sent') {
                    // Успех! Очищаем форму, показываем сообщение...
                    clearFormInputs(form);
                    displayMessage(form, data.message, 'success');

                    // --- 🔥 GTM CUSTOM EVENT TRIGGER ---
                    // Отправляем кастомное событие в dataLayer для GTM
                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                        'event': 'form_submission_success'
                    });
                    console.log('GTM custom event "form_submission_success" pushed to dataLayer.');
                    // ------------------------------------

                } else {
                    // Если воркер вернул ошибку (например, 403 от Turnstile) или другую проблему
                    throw new Error(data.message || 'An unknown server error occurred.');
                }

            } catch (error) {
                console.error('Form submission error:', error);
                // ИЗМЕНЕНО: Показываем осмысленное сообщение об ошибке
                displayMessage(form, error.message, 'error');
            } finally {
                // --- ОРИГИНАЛЬНЫЙ КОД (без изменений) ---
                const formContainer = form.closest('.vehica-contact-form');
                if (formContainer) {
                    formContainer.style.height = '10%';
                }

                // Возвращаем кнопке исходное состояние
                if (submitButton) {
                    submitButton.value = originalButtonText;
                    submitButton.disabled = false;
                }
                
                // --- ДОБАВЛЕНО: СБРОС WIDGET'А TURNSTILE ---
                // Это нужно, чтобы после ошибки пользователь мог попробовать снова
                if (typeof turnstile !== 'undefined') {
                    document.querySelectorAll('.cf-turnstile').forEach(widget => {
                        turnstile.reset(widget);
                    });
                }
                // --- КОНЕЦ ДОБАВЛЕННОГО БЛОКА ---
            }
        });
    });
});

// --- ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ---

/**
 * Проверяет корректность email с помощью регулярного выражения.
 * @param {string} email 
 * @returns {boolean}
 */
function isValidEmail(email) {
    if (!email) return false;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email.trim());
}

/**
 * Подсвечивает невалидное поле красной рамкой.
 * @param {HTMLElement} field 
 */
function highlightField(field) {
    if (field) {
        field.style.borderColor = '#ff0000'; // Красный цвет
        field.style.borderWidth = '2px';
    }
}

/**
 * Сбрасывает стили для всех полей формы, которые могли быть подсвечены.
 * @param {HTMLFormElement} form 
 */
function resetFieldStyles(form) {
    form.querySelectorAll('input[name="your-email"], input[name="vehica-accept"]').forEach(field => {
        field.style.borderColor = '';
        field.style.borderWidth = '';
    });
}

/**
 * Очищает все поля ввода в форме.
 * @param {HTMLFormElement} form 
 */
function clearFormInputs(form) {
    form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea').forEach(input => {
        input.value = '';
    });
    const checkbox = form.querySelector('input[name="vehica-accept"]');
    if (checkbox) {
        checkbox.checked = false;
    }
    resetFieldStyles(form); // Также сбрасываем стили при очистке
}

/**
 * Отображает сообщение о статусе отправки (успех или ошибка).
 * @param {HTMLFormElement} form 
 * @param {string} message 
 * @param {'success' | 'error'} type 
 */
function displayMessage(form, message, type) {
    removeOldMessages(form);
    const submitButton = form.querySelector('.wpcf7-submit');
    if (!submitButton) return;

    const output = document.createElement('div');
    output.className = 'wpcf7-response-output';
    output.textContent = message;
    output.style.display = 'block';

    if (type === 'success') {
        output.classList.add('wpcf7-mail-sent-ok');
        output.style.borderColor = '#46b450'; // Зеленый
    } else {
        output.classList.add('wpcf7-validation-errors');
        output.style.borderColor = '#ff0000'; // Красный
    }
    // Вставляем сообщение перед кнопкой отправки
    submitButton.parentNode.insertBefore(output, submitButton);
}

/**
 * Удаляет все предыдущие сообщения о статусе из формы.
 * @param {HTMLFormElement} form 
 */
function removeOldMessages(form) {
    const existingMessage = form.querySelector('.wpcf7-response-output');
    if (existingMessage) {
        existingMessage.remove();
    }
}
</script></body></html>